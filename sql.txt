create database authorization6;
use authorization6;


CREATE TABLE POST_TABLE (ID INT PRIMARY KEY, AUTHOR VARCHAR(50), DESCRIPTION VARCHAR(50), LIKEVOTES INT, DISLIKEVOTES INT, DATE datetime  )
DROP TABLE POST_TABLE
------------------------------------


CREATE PROCEDURE sp_POSTS
AS
SELECT * FROM POST_TABLE
GO;

EXEC sp_POSTS;



drop procedure sp_CREATEPOST



-- CREATE POST --
CREATE PROCEDURE sp_CREATEPOST
@ID int, @AUTHOR VARCHAR(50), @DESCRIPTION VARCHAR(50)
AS 
BEGIN
INSERT INTO POST_TABLE (ID, AUTHOR , DESCRIPTION , LIKEVOTES , DISLIKEVOTES , DATE   )VALUES ( @ID, @AUTHOR, @DESCRIPTION, 0, 0, GETDATE() )
END

exec sp_CREATEPOST @ID=2, @AUTHOR='ABBAS', @DESCRIPTION='THIS IS 2 COMMENT';
------------------------------------------

DROP TABLE COMMENT_TABLE




CREATE TABLE COMMENT_TABLE (ID INT PRIMARY KEY, COMMENT VARCHAR(50), COMMENTBY VARCHAR(50), POSTID INT)



DROP PROCEDURE sp_CREATECOMMENT

CREATE PROCEDURE sp_CREATECOMMENT
@COMMENT VARCHAR(50), @COMMENTBY VARCHAR(50), @ID INT, @POSTID INT
AS 
BEGIN
INSERT INTO COMMENT_TABLE (ID, COMMENT, COMMENTBY, POSTID) VALUES (@ID,@COMMENT, @COMMENTBY, @POSTID)
END

EXEC sp_CREATECOMMENT 



--SELECT * FROM COMMENT_TABLE


DROP PROCEDURE sp_COMBINED

CREATE PROCEDURE sp_COMBINED
AS
BEGIN
SELECT POST_TABLE.ID, POST_TABLE.DESCRIPTION, POST_TABLE.AUTHOR, POST_TABLE.LIKEVOTES, POST_TABLE.DISLIKEVOTES, COMMENT_TABLE.COMMENT, COMMENT_TABLE.COMMENTBY, COMMENT_TABLE.POSTID 
FROM POST_TABLE
INNER JOIN COMMENT_TABLE
ON POST_TABLE.ID=COMMENT_TABLE.ID
ORDER BY LIKEVOTES DESC, DATE DESC;
END;





DROP PROCEDURE sp_EDITPOST

CREATE PROCEDURE sp_EDITPOST
@ID INT, @DESCRIPTION VARCHAR(50)
AS
BEGIN
UPDATE POST_TABLE
SET DESCRIPTION = @DESCRIPTION
WHERE ID = @ID;
END

DROP PROCEDURE sp_DELETEPOST
CREATE PROCEDURE sp_DELETEPOST
@ID INT 
AS
BEGIN
DELETE FROM POST_TABLE WHERE ID = @ID
END;


DROP PROCEDURE sp_EDITCOMMENT

CREATE PROCEDURE sp_EDITCOMMENT
@ID INT, @COMMENT VARCHAR(50)
AS
BEGIN
UPDATE COMMENT_TABLE
SET COMMENT = @COMMENT
WHERE ID =@ID;
END

DROP PROCEDURE sp_DELETECOMMENT

CREATE PROCEDURE sp_DELETECOMMENT
@ID INT
AS
BEGIN
DELETE FROM COMMENT_TABLE WHERE ID=@ID
END;
-----------------------------
DROP PROCEDURE sp_VOTEUP

CREATE PROCEDURE sp_VOTEUP
@ID INT
AS
BEGIN
UPDATE POST_TABLE
SET LIKEVOTES = LIKEVOTES+1
WHERE ID =@ID;
END

-----------------------------
DROP PROCEDURE sp_VOTEDOWN

CREATE PROCEDURE sp_VOTEDOWN
@ID INT
AS 
BEGIN
UPDATE POST_TABLE
SET DISLIKEVOTES = DISLIKEVOTES+1
WHERE ID =@ID;
END

----------------
CREATE PROCEDURE sp_SORT
AS 
BEGIN
SELECT * 
FROM POST_TABLE
ORDER BY LIKEVOTES DESC, DATE DESC;
END
